<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wario-Web Ultimate</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  background: #000;
  color: #fff;
  font-family: Arial, sans-serif;
  overflow: hidden;
}
canvas {
  display: block;
  margin: auto;
}
#hud {
  position: absolute;
  top: 10px;
  left: 10px;
}
#rule {
  position: absolute;
  top: 42%;
  width: 100%;
  text-align: center;
  font-size: 32px;
}
#startScreen {
  position: fixed;
  inset: 0;
  background: #000;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 10;
  text-align: center;
}
#startScreen button {
  font-size: 24px;
  padding: 15px 40px;
  cursor: pointer;
}
.flash {
  animation: flash 0.3s;
}
@keyframes flash {
  from { background:#fff; }
  to { background:#000; }
}
</style>
</head>
<body>

<!-- START SCREEN -->
<div id="startScreen">
  <h1>üéÆ WARIO-WEB ULTIMATE</h1>
  <button id="startBtn">START</button>
  <p style="font-size:14px;margin-top:20px;">
    Tilt to move ¬∑ Tap / Space to act
  </p>
</div>

<!-- HUD -->
<div id="hud">
  Score: <span id="score">0</span><br>
  Lives: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
</div>
<div id="rule"></div>
<canvas id="game" width="360" height="640"></canvas>

<script>
/* ======================
   CORE SETUP
====================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const ruleEl = document.getElementById("rule");
const scoreEl = document.getElementById("score");
const livesEl = document.getElementById("lives");
const startScreen = document.getElementById("startScreen");
const startBtn = document.getElementById("startBtn");

let keys = {};
let score = 0;
let lives = 4;
let timer = 0;
let duration = 220;
let game;
let running = false;
let bossRound = false;

/* INPUT */
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);
canvas.addEventListener("touchstart", () => keys[" "] = true);
canvas.addEventListener("mousedown", () => keys[" "] = true);

/* AUDIO (unlocked on start) */
let audio;
function sfx(freq=400,time=0.1){
  if(!audio) return;
  const o=audio.createOscillator(),g=audio.createGain();
  o.frequency.value=freq;
  o.connect(g); g.connect(audio.destination);
  o.start();
  g.gain.exponentialRampToValueAtTime(0.001,audio.currentTime+time);
  o.stop(audio.currentTime+time);
}

/* GYRO */
let gyro={x:0,y:0};
function enableGyro(){
  if (typeof DeviceOrientationEvent?.requestPermission === "function") {
    DeviceOrientationEvent.requestPermission().then(res=>{
      if(res==="granted"){
        window.addEventListener("deviceorientation", e=>{
          gyro.x += ((e.gamma||0)-gyro.x)*0.15;
          gyro.y += ((e.beta||0)-gyro.y)*0.15;
        });
      }
    });
  } else {
    window.addEventListener("deviceorientation", e=>{
      gyro.x += ((e.gamma||0)-gyro.x)*0.15;
      gyro.y += ((e.beta||0)-gyro.y)*0.15;
    });
  }
}

/* PLAYER */
const player={x:180,y:520,r:15};
let enemies=[];

/* HELPERS */
function hit(a,b){return Math.hypot(a.x-b.x,a.y-b.y)<a.r+b.r;}
function fail(){
  lives--; sfx(120);
  livesEl.textContent="‚ù§Ô∏è".repeat(lives);
  if(lives<=0){
    alert("GAME OVER\nScore: "+score);
    location.reload();
  }
  startGame();
}
function win(){
  score++; sfx(700);
  scoreEl.textContent=score;
  startGame();
}

/* ======================
   MICROGAMES
====================== */
const games=[];
function add(text,init,update){ games.push({text,init,update}); }

/* BASIC */
add("DODGE!",()=>{
  enemies=[{x:Math.random()*360,y:-20,s:3+score*0.05}];
},()=>{
  enemies.forEach(e=>{
    e.y+=e.s;
    if(hit(player,{x:e.x,y:e.y,r:15})) fail();
  });
});

add("TAP!",()=>{},()=>{
  if(keys[" "]||keys["Space"]){ keys[" "]=false; win(); }
});

/* FINE TILT */
add("HOLD CENTER!",()=>{
  game.t=60;
},()=>{
  if(Math.abs(player.x-180)<8){
    game.t--; if(game.t<=0) win();
  } else game.t=60;
});

/* GYRO */
add("LEVEL IT!",()=>{
  game.t=60;
},()=>{
  if(Math.abs(gyro.x)<4&&Math.abs(gyro.y)<4){
    game.t--; if(game.t<=0) win();
  } else game.t=60;
});

/* MEMORY */
add("REMEMBER!",()=>{
  game.pos=Math.random()*300+30;
  game.show=60;
},()=>{
  if(game.show>0) game.show--;
  else if(Math.abs(player.x-game.pos)<15) win();
});

/* BOSS */
add("BOSS!",()=>{
  enemies=[];
  for(let i=0;i<6;i++)
    enemies.push({x:Math.random()*360,y:-i*80,s:4+score*0.08});
},()=>{
  enemies.forEach(e=>{
    e.y+=e.s;
    if(hit(player,{x:e.x,y:e.y,r:15})) fail();
  });
});

/* ======================
   ENGINE
====================== */
function startGame(){
  timer=0;
  enemies=[];
  bossRound = score>0 && score%10===0;
  duration = bossRound ? 360 : Math.max(140,220-score*2);
  game = bossRound ? games[games.length-1]
                   : games[Math.floor(Math.random()*(games.length-1))];
  game.init();
  ruleEl.textContent = bossRound ? "BOSS!" : game.text;
  document.body.classList.add("flash");
  setTimeout(()=>document.body.classList.remove("flash"),300);
}

function update(){
  player.x += gyro.x*0.08;
  if(keys["ArrowLeft"]) player.x-=4;
  if(keys["ArrowRight"]) player.x+=4;
  player.x=Math.max(20,Math.min(340,player.x));

  game.update();
  timer++;
  if(timer>duration) win();
}

function draw(){
  ctx.clearRect(0,0,360,640);
  ctx.fillStyle="lime";
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fill();

  enemies.forEach(e=>{
    ctx.fillStyle="red";
    ctx.beginPath();
    ctx.arc(e.x,e.y,15,0,Math.PI*2);
    ctx.fill();
  });

  if(game.pos&&game.show>0){
    ctx.fillStyle="yellow";
    ctx.fillRect(game.pos-10,300,20,20);
  }
}

function loop(){
  if(running){
    update();
    draw();
  }
  requestAnimationFrame(loop);
}

/* START BUTTON */
startBtn.onclick = () => {
  audio = new (window.AudioContext||window.webkitAudioContext)();
  enableGyro();
  startScreen.style.display="none";
  running=true;
  startGame();
};

loop();
</script>
</body>
</html>
